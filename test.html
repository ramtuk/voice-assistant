<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Voice Assistant Test</title>
    <style>
        body { 
            font-family: Arial, sans-serif; 
            margin: 40px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: #333;
        }
        .container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }
        h1 {
            color: #4a5568;
            text-align: center;
            margin-bottom: 30px;
        }
        button {
            background: #4299e1;
            color: white;
            border: none;
            padding: 12px 20px;
            margin: 5px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            transition: background 0.3s;
        }
        button:hover {
            background: #3182ce;
        }
        .section {
            margin: 20px 0;
            padding: 20px;
            border: 2px solid #e2e8f0;
            border-radius: 10px;
        }
        #result {
            margin-top: 20px;
            padding: 15px;
            background: #f7fafc;
            border: 1px solid #cbd5e0;
            border-radius: 8px;
            white-space: pre-wrap;
            font-family: 'Courier New', monospace;
            max-height: 300px;
            overflow-y: auto;
        }
        .status {
            padding: 10px;
            border-radius: 5px;
            margin: 5px 0;
        }
        .success { background: #c6f6d5; color: #22543d; }
        .error { background: #fed7d7; color: #742a2a; }
        .loading { background: #bee3f8; color: #2c5282; }
    </style>
</head>
<body>
    <div class="container">
        <h1>üé§ –¢–µ—Å—Ç –≥–æ–ª–æ—Å–æ–≤–æ–≥–æ –∞—Å—Å–∏—Å—Ç–µ–Ω—Ç–∞</h1>
        
        <div class="section">
            <h3>üìä –û—Å–Ω–æ–≤–Ω—ã–µ endpoints:</h3>
            <button onclick="testEndpoint('/')">Status</button>
            <button onclick="testEndpoint('/health')">Health</button>
            <button onclick="testEndpoint('/routes')">Routes</button>
        </div>

        <div class="section">
            <h3>üéµ –¢–µ—Å—Ç –∞—É–¥–∏–æ —Ñ—É–Ω–∫—Ü–∏–π:</h3>
            <input type="file" id="audioFile" accept=".wav,.mp3,audio/*">
            <button onclick="testAudio()">Process Audio ‚Üí –¢–µ–∫—Å—Ç</button>
            <button onclick="testCommand()">Process Command ‚Üí –û—Ç–≤–µ—Ç</button>
        </div>

        <div class="section">
            <h3>üìã –†–µ–∑—É–ª—å—Ç–∞—Ç:</h3>
            <div id="result">–ù–∞–∂–º–∏—Ç–µ –ª—é–±—É—é –∫–Ω–æ–ø–∫—É –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è...</div>
        </div>

        <div class="section">
            <h3>üìä –°—Ç–∞—Ç—É—Å —Å–µ—Ä–≤–µ—Ä–∞:</h3>
            <div id="serverStatus">–ü—Ä–æ–≤–µ—Ä–∫–∞...</div>
        </div>
    </div>

    <script>
    // –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞ —Å–µ—Ä–≤–µ—Ä–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
    checkServerStatus();

    async function checkServerStatus() {
        try {
            const response = await fetch('http://' + window.location.hostname + ':8000/health');
            const data = await response.json();
            document.getElementById('serverStatus').innerHTML = 
                `<div class="status success">‚úÖ –°–µ—Ä–≤–µ—Ä —Ä–∞–±–æ—Ç–∞–µ—Ç: ${data.status}, –ú–æ–¥–µ–ª—å: ${data.model_loaded ? '–∑–∞–≥—Ä—É–∂–µ–Ω–∞' : '–Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω–∞'}</div>`;
        } catch (error) {
            document.getElementById('serverStatus').innerHTML = 
                `<div class="status error">‚ùå –°–µ—Ä–≤–µ—Ä –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω: ${error}</div>`;
        }
    }

    async function testEndpoint(endpoint) {
        showResult('‚è≥ –ó–∞–≥—Ä—É–∑–∫–∞...', 'loading');
        try {
            const response = await fetch('http://' + window.location.hostname + ':8000' + endpoint);
            const data = await response.json();
            showResult(`‚úÖ ${endpoint}:\n${JSON.stringify(data, null, 2)}`, 'success');
        } catch (error) {
            showResult(`‚ùå –û—à–∏–±–∫–∞: ${error}`, 'error');
        }
    }

    async function testAudio() {
        const fileInput = document.getElementById('audioFile');
        if (!fileInput.files[0]) {
            showResult('‚ùå –í—ã–±–µ—Ä–∏—Ç–µ –∞—É–¥–∏–æ —Ñ–∞–π–ª!', 'error');
            return;
        }

        showResult('‚è≥ –û–±—Ä–∞–±–∞—Ç—ã–≤–∞—é –∞—É–¥–∏–æ...', 'loading');
        
        const formData = new FormData();
        formData.append('file', fileInput.files[0]);

        try {
            const response = await fetch('http://' + window.location.hostname + ':8000/process_audio', {
                method: 'POST',
                body: formData
            });
            const data = await response.json();
            showResult(`üéµ –†–µ–∑—É–ª—å—Ç–∞—Ç —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏—è:\n–¢–µ–∫—Å—Ç: "${data.text}"\n–Ø–∑—ã–∫: ${data.lang || data.language}\n–£—Å–ø–µ—Ö: ${data.success !== false}`, 'success');
        } catch (error) {
            showResult(`‚ùå –û—à–∏–±–∫–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∞—É–¥–∏–æ: ${error}`, 'error');
        }
    }

    async function testCommand() {
        const fileInput = document.getElementById('audioFile');
        if (!fileInput.files[0]) {
            showResult('‚ùå –í—ã–±–µ—Ä–∏—Ç–µ –∞—É–¥–∏–æ —Ñ–∞–π–ª!', 'error');
            return;
        }

        showResult('‚è≥ –û–±—Ä–∞–±–∞—Ç—ã–≤–∞—é –∫–æ–º–∞–Ω–¥—É...', 'loading');
        
        const formData = new FormData();
        formData.append('audio', fileInput.files[0]);

        try {
            const response = await fetch('http://' + window.location.hostname + ':8000/process_command', {
                method: 'POST',
                body: formData
            });
            const data = await response.json();
            showResult(`ü§ñ –†–µ–∑—É–ª—å—Ç–∞—Ç –∫–æ–º–∞–Ω–¥—ã:\n–¢–µ–∫—Å—Ç: "${data.original_text}"\n–î–µ–π—Å—Ç–≤–∏–µ: ${data.action}\n–û—Ç–≤–µ—Ç: "${data.response}"`, 'success');
        } catch (error) {
            showResult(`‚ùå –û—à–∏–±–∫–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∫–æ–º–∞–Ω–¥—ã: ${error}`, 'error');
        }
    }

    function showResult(text, type = '') {
        const resultDiv = document.getElementById('result');
        resultDiv.textContent = text;
        resultDiv.className = type;
    }

    // –ê–≤—Ç–æ–ø—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞ –∫–∞–∂–¥—ã–µ 30 —Å–µ–∫—É–Ω–¥
    setInterval(checkServerStatus, 30000);
    </script>
</body>
</html>